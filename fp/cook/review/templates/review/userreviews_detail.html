{% extends "base.html" %}
{% block content %}
    <h2>{{ userreviews.menu.menu_name }}</h2>
    <p><strong>ì‘ì„±ì:</strong> {{ userreviews.user.nickname }}</p>
    <p><strong>ë³„ì :</strong> <span class="star-display">â˜…</span> {{ userreviews.rating }}</p>
    <p>{{ userreviews.review_text }}</p>
    {% if userreviews.images.all %}
        <div class="review-images">
            {% for image in userreviews.images.all %}
                <img src="{{ image.image_url }}" class="review-image">
            {% endfor %}
        </div>
    {% endif %}
    <p><strong>ì¡°íšŒìˆ˜:</strong> {{ review.views }}</p>
    <p>{{ review.review_text }}</p>

     <!-- ì²« ë²ˆì§¸ ì‚¬ì§„ + ì¶”ê°€ ì‚¬ì§„ ê°œìˆ˜ í‘œì‹œ (í´ë¦­ ì‹œ ê°¤ëŸ¬ë¦¬ ì—´ê¸°) -->
     {% if review.images.all %}
     <div class="review-images">
         <div class="main-image">
             <img src="{{ review.images.first.image.url }}" alt="ë¦¬ë·° ì´ë¯¸ì§€" class="review-image">
             {% if review.images.all|length > 1 %}
                 <span class="image-count" onclick="openGallery()">+{{ review.images.all|length|add:"-1" }}</span>
             {% endif %}
         </div>
     </div>
 {% endif %}

 <!-- ê°¤ëŸ¬ë¦¬ ëª¨ë‹¬ (í´ë¦­ ì‹œ ì „ì²´ í™”ë©´ ë³´ê¸°) -->
 <div id="image-gallery" class="gallery-modal">
     <span class="close" onclick="closeGallery()">&times;</span>
     <div class="gallery-wrapper">
         {% for image in review.images.all %}
             <img src="{{ image.image.url }}" class="gallery-image" onclick="openFullScreen({{ forloop.counter0 }})">
         {% endfor %}
     </div>
 </div>

 <!-- ì „ì²´ í™”ë©´ ëª¨ë‹¬ (ì¢Œìš° ì´ë™ ê°€ëŠ¥) -->
 <div id="fullscreen-modal" class="fullscreen-modal">
     <span class="close" onclick="closeFullScreen()">&times;</span>
     <span class="arrow left" onclick="changeImage(-1)">&#10094;</span>
     <img id="fullscreen-image" class="fullscreen-image">
     <span class="arrow right" onclick="changeImage(1)">&#10095;</span>
 </div>


    <!-- ëŒ“ê¸€ ëª©ë¡ -->
    <h3>ëŒ“ê¸€</h3>
    <ul id="comment-list">
        {% for comment in userreviews.comments.all %}
            <li>
                <strong>{{ comment.user.nickname }}</strong>: {{ comment.comment_text }}
                <button class="like-btn" onclick="likeComment({{ comment.id }})">ğŸ‘ ì¢‹ì•„ìš” (<span id="like-count-{{ comment.id }}">{{ comment.like_count }}</span>)</button>
            </li>
        {% endfor %}
    </ul>

    <script>
        function likeComment(commentId) {
            fetch(`/comment/${commentId}/like/`, {
                method: "POST",
                headers: { "X-CSRFToken": "{{ csrf_token }}" }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById(`like-count-${commentId}`).innerText = data.like_count;
            });
        }
    </script>
    <a href="{% url 'userreviews_list' %}">ëª©ë¡ìœ¼ë¡œ</a>
{% endblock %}
