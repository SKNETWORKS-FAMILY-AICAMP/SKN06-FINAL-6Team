{% extends "base.html" %}
{% block content %}
    <h2>{{ userreviews.menu.menu_name }}</h2>
    <p><strong>작성자:</strong> {{ userreviews.user.nickname }}</p>
    <p><strong>별점:</strong> <span class="star-display">★</span> {{ userreviews.rating }}</p>
    <p>{{ userreviews.review_text }}</p>
    {% if userreviews.images.all %}
        <div class="review-images">
            {% for image in userreviews.images.all %}
                <img src="{{ image.image_url }}" class="review-image">
            {% endfor %}
        </div>
    {% endif %}

    <!-- 댓글 목록 -->
    <h3>댓글</h3>
    <ul id="comment-list">
        {% for comment in userreviews.comments.all %}
            <li>
                <strong>{{ comment.user.nickname }}</strong>: {{ comment.comment_text }}
                <button class="like-btn" onclick="likeComment({{ comment.id }})">👍 좋아요 (<span id="like-count-{{ comment.id }}">{{ comment.like_count }}</span>)</button>
            </li>
        {% endfor %}
    </ul>

    <script>
        function likeComment(commentId) {
            fetch(`/comment/${commentId}/like/`, {
                method: "POST",
                headers: { "X-CSRFToken": "{{ csrf_token }}" }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById(`like-count-${commentId}`).innerText = data.like_count;
            });
        }
    </script>
    <a href="{% url 'userreviews_list' %}">목록으로</a>
{% endblock %}
